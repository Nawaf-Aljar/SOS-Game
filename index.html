<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>SOS â€” Multiplayer Game</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <!-- MODE SELECTION -->
        <div id="modePanel">
            <h1>SOS Multiplayer</h1>
            <button id="localBtn">Local Multiplayer</button>
            <button id="aiBtn" style="background:#8b5cf6;">Play vs AI</button>
            <button id="createOnlineBtn" style="background:#10b981;">Create Online Game</button>
            <button id="joinOnlineBtn" style="background:#f59e0b;">Join Online Game</button>
        </div>

        <!-- LOBBY PANEL -->
        <div id="lobbyPanel" class="hidden">
            <h1 id="lobbyTitle">Game Lobby</h1>

            <div id="createLobby" class="hidden">
                <label>Your Name</label>
                <input id="hostName" type="text" value="Player 1">
                <label>Your Color</label>
                <input id="hostColor" type="color" value="#3b82f6">
                <label>Number of Players</label>
                <select id="onlinePlayerCount">
                    <option value="2">2 Players</option>
                    <option value="3">3 Players</option>
                    <option value="4">4 Players</option>
                    <option value="5">5 Players</option>
                </select>
                <label>Grid Size (3 - 20)</label>
                <input id="onlineGridSize" type="number" min="3" max="20" value="8">

                <!-- Timer settings for online mode -->
                <div class="timer-settings">
                    <div class="timer-toggle">
                        <input type="checkbox" id="onlineTimerCheckbox" checked>
                        <label for="onlineTimerCheckbox">No Timer</label>
                    </div>
                    <div id="onlineTimerSettings" class="hidden">
                        <label>Time per move (minutes)</label>
                        <select id="onlineTimerDuration">
                            <option value="0.5">0.5 min</option>
                            <option value="1">1 min</option>
                            <option value="1.5">1.5 min</option>
                            <option value="2" selected>2 min</option>
                            <option value="3">3 min</option>
                            <option value="5">5 min</option>
                            <option value="10">10 min</option>
                        </select>
                    </div>
                </div>

                <button id="createRoomBtn">Create Room</button>
            </div>

            <div id="joinLobby" class="hidden">
                <label>Your Name</label>
                <input id="guestName" type="text" value="Player 2">
                <label>Your Color</label>
                <input id="guestColor" type="color" value="#ef4444">
                <label>Room Code</label>
                <input id="roomCodeInput" type="text" placeholder="Enter 6-character code" maxlength="6"
                    style="text-transform:uppercase;">
                <button id="joinRoomBtn">Join Room</button>
            </div>

            <div id="waitingRoom" class="hidden">
                <div class="room-code" id="displayRoomCode"></div>
                <div class="waiting">Share this code with other players</div>
                <div class="player-list" id="playerList"></div>
                <button id="startOnlineBtn">Start Game</button>
            </div>

            <button class="secondary" id="backToModeBtn">Back</button>
        </div>

        <!-- LOCAL SETUP PANEL -->
        <div id="setupPanel" class="hidden">
            <h1>Local Multiplayer Setup</h1>

            <label>Number of Players</label>
            <select id="playerCount">
                <option value="2">2 Players</option>
                <option value="3">3 Players</option>
                <option value="4">4 Players</option>
                <option value="5">5 Players</option>
            </select>

            <div id="playersContainer" class="player-setup"></div>

            <div class="size-toggle">
                <input type="checkbox" id="customSizeCheck">
                <label for="customSizeCheck">Custom Board Size</label>
            </div>

            <div id="squareSize">
                <label>Grid Size (3 - 20)</label>
                <input id="gridSize" type="number" min="3" max="20" value="8">
            </div>

            <div id="customSize" class="hidden">
                <div>
                    <label>Width (3 - 20)</label>
                    <input id="gridWidth" type="number" min="3" max="20" value="8">
                </div>
                <div>
                    <label>Height (3 - 20)</label>
                    <input id="gridHeight" type="number" min="3" max="20" value="8">
                </div>
            </div>

            <!-- Timer settings for local mode -->
            <div class="timer-settings">
                <div class="timer-toggle">
                    <input type="checkbox" id="timerCheckbox" checked>
                    <label for="timerCheckbox">No Timer</label>
                </div>
                <div id="timerSettings" class="hidden">
                    <label>Time per move (minutes)</label>
                    <select id="timerDuration">
                        <option value="0.5">0.5 min</option>
                        <option value="1">1 min</option>
                        <option value="1.5">1.5 min</option>
                        <option value="2" selected>2 min</option>
                        <option value="3">3 min</option>
                        <option value="5">5 min</option>
                        <option value="10">10 min</option>
                    </select>
                </div>
            </div>

            <button id="startBtn">Start Game</button>
            <button class="secondary" id="backBtn">Back</button>
            <div class="rules">
                Rules: Place S or O. Form "SOS" horizontally, vertically, or diagonally to score and move again.
            </div>
        </div>

        <!-- AI SETUP PANEL -->
        <div id="aiSetupPanel" class="hidden">
            <h1>Play vs AI</h1>

            <div class="player-inputs">
                <div>
                    <label>Your Name</label>
                    <input id="aiPlayerName" type="text" value="Player">
                    <label>Your Color</label>
                    <input id="aiPlayerColor" type="color" value="#3b82f6">
                </div>
                <div>
                    <label>AI Name</label>
                    <input id="aiName" type="text" value="AI">
                    <label>AI Color</label>
                    <input id="aiColor" type="color" value="#ef4444">
                </div>
            </div>

            <label>AI Difficulty</label>
            <select id="aiDifficulty">
                <option value="easy">Easy (Random)</option>
                <option value="medium" selected>Medium (Smart)</option>
            </select>

            <div class="size-toggle">
                <input type="checkbox" id="customSizeCheckAI">
                <label for="customSizeCheckAI">Custom Board Size</label>
            </div>

            <div id="squareSizeAI">
                <label>Grid Size (3 - 20)</label>
                <input id="gridSizeAI" type="number" min="3" max="20" value="8">
            </div>

            <div id="customSizeAI" class="hidden">
                <div>
                    <label>Width (3 - 20)</label>
                    <input id="gridWidthAI" type="number" min="3" max="20" value="8">
                </div>
                <div>
                    <label>Height (3 - 20)</label>
                    <input id="gridHeightAI" type="number" min="3" max="20" value="8">
                </div>
            </div>

            <!-- Timer settings for AI mode -->
            <div class="timer-settings">
                <div class="timer-toggle">
                    <input type="checkbox" id="timerCheckboxAI" checked>
                    <label for="timerCheckboxAI">No Timer</label>
                </div>
                <div id="timerSettingsAI" class="hidden">
                    <label>Time per move (minutes)</label>
                    <select id="timerDurationAI">
                        <option value="0.5">0.5 min</option>
                        <option value="1">1 min</option>
                        <option value="1.5">1.5 min</option>
                        <option value="2" selected>2 min</option>
                        <option value="3">3 min</option>
                        <option value="5">5 min</option>
                        <option value="10">10 min</option>
                    </select>
                </div>
            </div>

            <button id="startAIBtn">Start Game</button>
            <button class="secondary" id="backAIBtn">Back</button>
        </div>

        <!-- GAME UI -->
        <div id="gameUI" class="hidden">
            <div class="game-header" id="playerCardsContainer">
                <button class="secondary" id="menuBtn" style="background:#475569;">Back to Menu</button>
                <div id="globalTimer" class="global-timer hidden">
                    <span class="global-timer-label">Time Left:</span>
                    <span id="globalTimerDisplay" class="global-timer-display">02:00</span>
                </div>
            </div>

            <div class="board-container">
                <div id="board" class="board"></div>
                <svg id="svgLayer" class="svg-layer"></svg>
            </div>

            <div class="log-panel" id="log"></div>
        </div>
    </div>

    <!-- GAME OVER MODAL -->
    <div id="gameOverModal" class="modal-overlay hidden">
        <div class="modal-content">
            <div id="winnerText" class="modal-title">PLAYER WINS</div>
            <div class="modal-subtitle">Final Scores</div>
            <div id="finalScore" class="modal-score"></div>

            <div class="modal-buttons">
                <button id="modalRestartBtn">Play Again</button>
                <button id="modalMenuBtn" class="secondary">Back to Menu</button>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="app.js"></script>
</body>
</html>